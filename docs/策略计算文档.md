# 策略计算文档

## **1. 核心概率计算**

### **1.1 基本参数**

```
S = 比特币现货价格（USD）
K = 行权价（USD）
T = 剩余时间（年）
r = 无风险利率
σ = 年化隐含波动率

```

### **1.2 Black-Scholes 概率计算**

```
d₁ = [ln(S/K) + (r + σ²/2) × T] / (σ × √T)
d₂ = d₁ - σ × √T
P(S_T > K) = N(d₂)  # 标准正态累积分布函数

```

### **1.3 价格区间概率**

```
P_interval1 = P(S_T < K₁) = 1 - N(d₂@K₁)
P_interval2 = P(K₁ ≤ S_T < K_poly) = N(d₂@K₁) - N(d₂@K_poly)
P_interval3 = P(K_poly ≤ S_T < K₂) = N(d₂@K_poly) - N(d₂@K₂)
P_interval4 = P(S_T ≥ K₂) = N(d₂@K₂)

```

---

## **2. 头寸规模计算**

### **2.1 策略一：做多Poly + 做空Deribit**

```
Polymarket投资：Inv_Base
Deribit合约数：Contracts_Short = Inv_Base / Income_Deribit
Income_Deribit = Call_K1_Bid - Call_K2_Ask

```

### **2.2 策略二：做空Poly + 做多Deribit**

```
Polymarket投资：Inv_Base
最大盈利：Profit_Poly_Max = Inv_Base × (1/Price_No_entry - 1)
Deribit合约数：Contracts_Long = Profit_Poly_Max / Cost_Deribit
Cost_Deribit = Call_K1_Ask - Call_K2_Bid

```

---

## **3. 成本模型**

### **3.1 开仓成本（一次性）**

```
开仓成本 =
  Deribit_Option_Fee +
  区块链成本（开仓部分）

其中：
Deribit_Option_Fee = [MIN(0.0003 BTC, 0.125 × Price_Option1) + MIN(0.0003 BTC, 0.125 × Price_Option2)] × Contracts × BTC_Price
区块链成本 = $0.025（开仓Gas费）

```

### **3.2 持仓期间成本**

```
持仓成本_t = 保证金成本_t + 资金机会成本_t

保证金成本_t = Margin_Requirement × r × (持仓天数/365)
资金机会成本_t = 总投资 × r × (持仓天数/365)

```

### **3.3 平仓成本**

```
平仓成本_tX = 滑点成本_tX + 区块链成本（平仓部分）

滑点成本_tX = Inv_Base × Slippage_Rate(tX)
区块链成本 = $0.025（平仓Gas费）

```

### **3.4 总成本分解**

```
总成本 = 开仓成本 + 持仓成本 + 平仓成本

```

---

## **4. 事前预期盈亏计算（开仓时刻）**

### **4.1 策略一：事前预期**

### **预期Deribit P&L**

```
E[Deribit_P&L] = Income_Deribit × Contracts_Short + E[行权盈亏]

E[行权盈亏] = Σ [P(interval_i) × 行权盈亏(midpoint_i)]

```

### **预期Polymarket P&L**

```
E[Poly_P&L] = Σ [P(interval_i) × Poly_P&L(midpoint_i)]

```

### **事前总预期**

```
事前总预期 = E[Poly_P&L] + E[Deribit_P&L] - 总成本

```

### **4.2 策略二：事前预期**

### **预期Deribit P&L**

```
E[Deribit_P&L] = -Cost_Deribit × Contracts_Long + E[行权盈亏]

```

### **预期Polymarket P&L**

```
E[Poly_P&L] = Σ [P(interval_i) × Poly_P&L(midpoint_i)]

```

### **事前总预期**

```
事前总预期 = E[Poly_P&L] + E[Deribit_P&L] - 总成本

```

---

## **5. 事后实际盈亏计算（各时间节点）**

### **5.1 已实现盈亏计算框架**

### **已实现部分**

```
已实现盈亏 = 已实现Poly_P&L + 已实现Deribit_P&L - 已发生成本

```

### **未实现部分**

```
未实现盈亏 = 未实现Poly_P&L + 未实现Deribit_P&L - 预计未来成本

```

### **5.2 各时间节点计算**

### **策略A：UTC 00:00 平仓**

```
已实现：
- Poly_P&L(Price_Yes_00:00)
- 已发生成本：开仓成本 + 持仓成本(到00:00) + 平仓成本(00:00)

未实现：
- Deribit_P&L（到08:00结算）
- 剩余持仓成本（00:00到08:00）

```

### **策略B：UTC 04:00 平仓**

```
已实现：
- Poly_P&L(Price_Yes_04:00)
- 已发生成本：开仓成本 + 持仓成本(到04:00) + 平仓成本(04:00)

未实现：
- Deribit_P&L（到08:00结算）
- 剩余持仓成本（04:00到08:00）

```

### **策略C：UTC 08:00 平仓**

```
已实现：
- Poly_P&L(Price_Yes_08:00)
- Deribit_P&L（已结算）
- 已发生成本：开仓成本 + 持仓成本(到08:00) + 平仓成本(08:00)

未实现：无

```

### **策略D：UTC 12:00 平仓**

```
已实现：
- Poly_P&L(Price_Yes_12:00)
- Deribit_P&L（已结算）
- 已发生成本：开仓成本 + 持仓成本(到12:00) + 平仓成本(12:00)

未实现：无

```

### **策略E：UTC 16:00 平仓**

```
已实现：
- Poly_P&L(Price_Yes_16:00) - 自动结算，无滑点
- Deribit_P&L（已结算）
- 已发生成本：开仓成本 + 持仓成本(到16:00)

未实现：无

```

### **5.3 持仓期间的事前预期重估**

在任意时间点t，可以重新计算剩余头寸的事前预期：

```
重估事前预期_t =
  已实现盈亏_t +
  E[剩余头寸_P&L | 当前市场条件] -
  预计未来成本_t

```

其中：

- `E[剩余头寸_P&L | 当前市场条件]` 使用当前价格、波动率、剩余时间重新计算
- `预计未来成本_t` 包括剩余持仓成本和预计平仓成本

---

## **6. 预期收益计算（分离版本）**

### **6.1 开仓时刻的事前预期**

```
事前EV = Σ [P(interval_i) × 总P&L(midpoint_i)] - 总成本

```

### **6.2 各时间节点的事后计算**

```
事后P&L_Strategy_X = 已实现盈亏_X + 未实现盈亏_X

```

### **6.3 持仓期间的预期重估**

```
重估EV_t = 已实现盈亏_t + E[剩余头寸_P&L] - 预计未来成本_t

```

---

## **7. 记录要求**

### **7.1 必须记录的时间点**

```
1. 开仓时刻：事前预期 + 成本预算
2. 每个平仓策略时间点：事后实际P&L
3. 持仓期间关键时点：重估事前预期
4. 最终结算：完整事后P&L

```

### **7.2 记录内容**

**开仓记录：**

- 事前预期EV
- 各策略预期排名
- 成本预算分解

**持仓记录：**

- 已实现盈亏
- 未实现盈亏
- 重估事前预期
- 与原始预期的偏差

**平仓记录：**

- 实际P&L
- 实际成本分解
- 与预期的对比分析