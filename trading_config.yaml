mode:
  # Deprecated
  dry_run: true            # execute endpoint always returns DRY_RUN
  # Deprecated
  allow_execute: true      # set false to disable trading completely
  log_trades: true         # CSV-based trade logging


# ----------------------------------------------------------------------------
# FILTERS — used BEFORE calling EV engine
# ----------------------------------------------------------------------------
filters:

  # Minimum profitability thresholds  
  ev:
    min_ev_usd_1000: 0             # ±EV (usd per $1k investment)
    min_ev_pct: 0.0                 # EV percentage threshold (%)
    min_divergence: 0.01            # PM price vs DR implied prob

  # Liquidity safety  
  liquidity:
    min_pm_liquidity_usd: 3000      # ensures PM can absorb size
    min_dr_liquidity_contracts: 3   # ensures DR spread is real

  # Stale data protection  
  staleness:
    max_pm_age_sec: 30
    max_db_age_sec: 15
    max_ev_age_sec: 60
    # Wait time between trades
    wait time:
      min_wait_sec: 300


# ----------------------------------------------------------------------------
# RISK LIMITS — mapped directly into /trade/sim + /trade/execute
# ----------------------------------------------------------------------------
risk_limits:

  sizing:
    # Deprecated
    default_investment_usd: 1000
    # Deprecated
    max_investment_usd: 2000       # hard cap for any single trade
    max_daily_total_usd: 20000     # optional (MVP ignored if not used)

  portfolio:
    max_open_positions: 3

  slippage:
    max_slippage_pct: 0.02         # used for both PM and DR

  expiry:
    min_minutes_to_dr_expiry: 10   # avoid near-expiry Deribit
    min_minutes_to_pm_resolution: 60


# ----------------------------------------------------------------------------
# EXECUTION SETTINGS
# (MVP = only dry-run mode, no live Polymarket/Deribit orders)
# ----------------------------------------------------------------------------
execution:

  polymarket:
    enabled: true                 # future use
    max_spend_usdc: 2000

  deribit:
    enabled: true                 # future use
    post_only: false
    reduce_only: false
    max_spend_usdc: 2000


# ----------------------------------------------------------------------------
# ALERTS / NOTIFICATIONS
# ----------------------------------------------------------------------------
alerts:
  telegram:
    enabled: true

    # BOT TOKENS FROM ENV VARIABLES
    alert_bot_token_env: "TELEGRAM_BOT_TOKEN_ALERT"
    trading_bot_token_env: "TELEGRAM_BOT_TOKEN_TRADING"
    chat_id_env: "TELEGRAM_CHAT_ID"

    # Which messages to send
    send_opportunities: true
    send_trade_executions: true
    # Deprecated
    send_errors: true
    # Deprecated
    send_recoveries: true

    # Retry logic for sending messages
    max_retries: 3
    retry_delay_seconds: 1
    retry_backoff: 2


# ----------------------------------------------------------------------------
# EARLY EXIT — 提前平仓配置
# ----------------------------------------------------------------------------
early_exit:
  # 功能开关
  enabled: true

  # 时间窗口检查（08:00-16:00 UTC）
  # 设为 false 可跳过时间检查，用于测试
  check_time_window: true

  # 亏损阈值（默认 5%）
  # - 亏损 <= 阈值：持有博反转
  # - 亏损 > 阈值：立即止损
  loss_threshold_pct: 0.00

  # 流动性检查倍数
  # 要求：可用流动性 >= 持仓数量 × 此倍数
  min_liquidity_multiplier: 1.0

  # 平仓手续费率（目前 PM 无手续费）
  exit_fee_rate: 0.0

  # 监控间隔（秒）
  check_interval_seconds: 60

  # 模拟模式（true = 不真实执行，只记录日志）
  dry_run: false

  # Telegram 通知
  send_notifications: true


# ----------------------------------------------------------------------------
# SECURITY — matches POST /trade/sim and /trade/execute
# ----------------------------------------------------------------------------
# Deprecated
auth:
  api_key_env: "Trading_api_key"
  allowed_ips: 104.248.192.200



# ----------------------------------------------------------------------------
# LOGGING
# ----------------------------------------------------------------------------
logging:
  trade_log_csv: "/data/trades.csv"
  enable_debug: true
